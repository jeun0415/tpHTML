const productsData = {
  1: [
    {
      name: "통밀빵",
      image: "../img/bread/1.jpg",
      description: "건강 통밀 그대로",
      kind: "Bread",
      url: "../html/productDetail.html",
    },
    {
      name: "무화과 깜빠뉴",
      image: "../img/bread/2.jpg",
      description: "본토 맛 그대로",
      kind: "Bread",
    },
    {
      name: "호밀빵",
      image: "../img/bread/3.jpg",
      description: "건강 호밀 그대로",
      kind: "Bread",
      new: "item_new",
    },
    {
      name: "크림치즈 깜빠뉴",
      image: "../img/bread/4.jpg",
      description: "크림치즈의 고소함",
      kind: "Bread",
    },
    {
      name: "허니 월넛 브레드",
      image: "../img/bread/5.jpg",
      description: "고소한 견과의 맛",
      kind: "Bread",
    },
    {
      name: "메론빵",
      image: "../img/bread/6.jpg",
      description: "달콤한 멜론 한입",
      kind: "Bread",
    },
    {
      name: "페이스트리",
      image: "../img/bread/7.jpg",
      description: "달콤 바삭한 식감",
      kind: "Bread",
    },
    {
      name: "견과 곡물 브레드",
      image: "../img/bread/8.jpg",
      description: "고소한 견과의 맛",
      kind: "Bread",
    },
    {
      name: "연유 바게트",
      image: "../img/bread/9.jpg",
      description: "부드러운 연유",
      kind: "Bread",
      new: "item_new",
    },
    {
      name: "소금빵",
      image: "../img/bread/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Bread",
    },
  ],
  2: [
    {
      name: "리치 생크링 케이크",
      image: "../img/cake/1.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
      new: "item_new",
    },
    {
      name: "시나몬 과일 케이크",
      image: "../img/cake/2.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "초코 무스 케이크",
      image: "../img/cake/3.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "젤리 케이크",
      image: "../img/cake/4.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "이벤트 케이크",
      image: "../img/cake/5.jpg",
      description: "짜지 않는 고소함",
      kind: "cake",
    },
    {
      name: "파티 케이크",
      image: "../img/cake/6.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "팬 크림 케이크",
      image: "../img/cake/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
      new: "item_new",
    },
    {
      name: "화이트 초코 케이크",
      image: "../img/cake/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "민트 초코 케이크",
      image: "../img/cake/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "초코 무스 케이크",
      image: "../img/cake/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
  ],
  3: [
    {
      name: "생크림 컵케이크",
      image: "../img/dessert/1.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "미니 케이크",
      image: "../img/dessert/2.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "미니 초코케이크",
      image: "../img/dessert/3.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
      new: "item_new",
    },
    {
      name: "커피크림 번",
      image: "../img/dessert/4.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "과일 조각케이크",
      image: "../img/Dessert/5.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "푸딩",
      image: "../img/dessert/6.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "카라멜 디저트",
      image: "../img/dessert/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "커스터드 푸딩",
      image: "../img/dessert/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
      new: "item_new",
    },
    {
      name: "치즈 조각케이크",
      image: "../img/dessert/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "치즈 조각케이크2",
      image: "../img/dessert/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
  ],
  4: [
    {
      name: "햄치즈샌드위치",
      image: "../img/sandwich/1.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "플랫샌드위치",
      image: "../img/sandwich/2.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "클럽샌드위치",
      image: "../img/sandwich/3.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "바게트 살라미 샌드",
      image: "../img/sandwich/4.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
      new: "item_new",
    },
    {
      name: "이탈리안BMT",
      image: "../img/sandwich/5.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "베이컨치즈더블",
      image: "../img/sandwich/6.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "오리지날 토스트",
      image: "../img/sandwich/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
      new: "item_new",
    },
    {
      name: "더블 치즈토스트",
      image: "../img/sandwich/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "맥스치킨토스트",
      image: "../img/sandwich/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "불고기치즈더블",
      image: "../img/sandwich/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
  ],
};

const recommendedProductsLeftData = {
  1: [
    {
      name: "소금빵",
      image: "../img/bread/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Bread",
    },
  ],
  2: [
    {
      name: "말차에 퐁당 딸기케이크",
      image: "../img/cake/2.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
  ],
  3: [
    {
      name: "쿠키생크림 조합",
      image: "../img/dessert/1.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
  ],
  4: [
    {
      name: "햄치즈 샌드위치",
      image: "../img/sandwich/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
  ],
};

const recommendedProductsRightData = {
  1: [
    {
      name: "페이스트리",
      image: "../img/bread/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Bread",
    },
    {
      name: "견과 곡물 브레드",
      image: "../img/bread/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Bread",
    },
    {
      name: "연유 바게트",
      image: "../img/bread/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Bread",
    },
    {
      name: "소금빵",
      image: "../img/bread/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Bread",
    },
  ],
  2: [
    {
      name: "팬 크림 케이크",
      image: "../img/cake/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "화이트 초코 케이크",
      image: "../img/cake/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "민트 초코 케이크",
      image: "../img/cake/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
    {
      name: "초코 무스 케이크",
      image: "../img/cake/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Cake",
    },
  ],
  3: [
    {
      name: "카라멜 디저트",
      image: "../img/dessert/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "커스터드 푸딩",
      image: "../img/dessert/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "치즈조각 케이크",
      image: "../img/dessert/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
    {
      name: "치즈조각 케이크2",
      image: "../img/dessert/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Dessert",
    },
  ],
  4: [
    {
      name: "오리지날 토스트",
      image: "../img/sandwich/7.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "더블 치즈 토스트",
      image: "../img/sandwich/8.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "맥스 치킨 토스트",
      image: "../img/sandwich/9.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
    {
      name: "불고기 치즈 더블",
      image: "../img/sandwich/10.jpg",
      description: "짜지 않는 고소함",
      kind: "Sandwich",
    },
  ],
};

let recommendedProductLeftSideRender = document.querySelector(
  ".recommended_left_area"
);
let recommendedProductRightSideRender = document.querySelector(
  ".recommended_right_area"
);
let productRender = document.querySelector(".product_rendering");

export function renderRecommendedProducts(categoryId) {
  /* common structure
    li              .recommended_item_wrap
    -- a    
    ---- span       .img
    ------ img          src
    ---- span       .info
    ------ span         .name
    ------ span         .txt_shape
   */
  eraseProducts(recommendedProductLeftSideRender);
  eraseProducts(recommendedProductRightSideRender);

  /* left side */
  drawRecommendedProducts(
    recommendedProductLeftSideRender,
    recommendedProductsLeftData,
    categoryId
  );

  /* right side */
  drawRecommendedProducts(
    recommendedProductRightSideRender,
    recommendedProductsRightData,
    categoryId
  );
}

export function renderProducts(categoryId) {
  /*
        product DOM structure

        li
        -- a        .item_best
        ---- span       .item_text
        ---- img        .item_img 
        ---- span       .item_info
        ------ span         .name
        ------ span         .txt_shape
        ------ span         .item_new
    */

  // 기존 컨텐츠 지우기
  eraseProducts(productRender);

  const products = productsData[categoryId];

  // 템플릿 리터럴 사용하여 HTML 생성
  const productHTML = products
    .map(
      (product) => `
      <li class="item">
        <a class="item_best">
          <span class="item_text">${product.name}</span>
          <img class="item_img" src="${product.image}" alt="${product.name}">
          <span class="item_info">
            <span class="name">${product.description}</span>
            <span class="txt_shape">${product.kind}</span>
            ${product.new ? `<span class="${product.new}"></span>` : ""}
          </span>
        </a>
        <span class="k-over">
          <span class="k-desc">
            <a href="../html/ShoppingCartPage.html">장바구니 담기</a>
          </span>
          <span class="k-btn_more2">
          <a href="#" onclick="selectProduct(event, '${product.name}', '${
        product.image
      }', '${product.description}', '${product.kind}')" class="">MORE</a>
          </span>
        </span>
      </li>
    `
    )
    .join("");

  // DOM에 한 번에 추가
  productRender.innerHTML = productHTML;

  // Longer text slice
  const itemTexts = document.querySelectorAll(".product_rendering .item_text");
  itemTexts.forEach((itemText) => doTextSlice(itemText, 160));

  // box-shadow changed
  const itemList = document.querySelectorAll(".product_rendering .item a");
  itemList.forEach((item) => {
    item.style.boxShadow = `2px 2px 8px 2px rgba(${255 - categoryId * 20}, ${
      180 - categoryId * 20
    }, ${41 + categoryId * 20}, 0.9)`;
  });
}

function doTextSlice(element, maxWidth) {
  let text = element.innerText;

  // offsetWidth = width + padding + margin;
  while (element.offsetWidth > maxWidth) {
    text = text.slice(0, -1);
    element.innerText = text + "..";
  }
}

function drawRecommendedProducts(renderProduct, productsData, categoryId) {
  const products = productsData[categoryId];

  const recommendedProductsHTML = products
    .map(
      (product) => `
    <li class="recommended_item_wrap">
      <a href="#"> <span class="img">
          <img src="${product.image}" alt="${product.name}">
        </span>
        <span class="info">
          <span class="name">${product.name}</span>
          <span class="txt_shape">${product.kind}</span>
        </span>
      </a>
      <span class="k-over">
        <span class="k-desc">
          <a href="#"></a>
        </span>
        <span class="k-btn_more2">
          <a href="#" class="k-more-btn">MORE</a>
        </span>
      </span>
    </li>
  `
    )
    .join("");

  renderProduct.innerHTML = recommendedProductsHTML;
}

function eraseProducts(parent) {
  while (parent.firstChild) {
    parent.removeChild(parent.firstChild);
  }
}

export function showMoreContent() {
  const itemWraps = document.querySelectorAll(".item");

  itemWraps.forEach((item) => {
    item.addEventListener("mouseover", () => {
      const img = item.querySelector(".item_img");
      const kOver = item.querySelector(".k-over");

      img.style.opacity = "0.95"; // 이미지의 불투명도를 낮춤
      kOver.style.display = "block"; // 텍스트와 버튼을 포함한 오버레이 보이기
      setTimeout(() => (kOver.style.opacity = "0.95"), 10); // 오버레이의 불투명도를 높임
    });
  });

  itemWraps.forEach((item) => {
    item.addEventListener("mouseout", () => {
      const img = item.querySelector(".item_img");
      const kOver = item.querySelector(".k-over");

      img.style.opacity = "1"; // 이미지의 불투명도를 원래대로 복원
      kOver.style.opacity = "0"; // 오버레이의 불투명도를 낮춤
    });
  });
}

function selectProduct(event, name, img, desc, kind) {
  event.preventDefault();
  const selectProduct = {
    name: name,
    img: img,
    desc: desc,
    kind: kind,
  };

  sessionStorage.setItem("selectProduct", JSON.stringify(selectProduct));

  window.location.href = "../html/productDetail.html";
}

window.selectProduct = selectProduct;
